// backend/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --------------------------------------
// ENUMS
// --------------------------------------

enum RolSistema {
  USER        // Accionista normal (ve solo sus datos)
  ADMIN       // Admin (ve todo y aprueba pagos)
  SUPERADMIN  // Acceso total
}

enum TipoAccionista {
  Fundador
  Inversionista
  Accionista_Mayoritario @map("Accionista Mayoritario")
  Accionista_Minoritario @map("Accionista Minoritario")
}

enum EstadoAccionista {
  Activo
  Suspendido
  Inactivo
}

enum EstadoPago {
  Completado
  Pendiente
  Rechazado
  En_proceso @map("En proceso")
}

enum PrioridadNotificacion {
  alta
  media
  baja
}

enum TipoNotificacion {
  pago_pendiente
  recordatorio
  alerta
  informacion
}

// --------------------------------------
// MODELOS
// --------------------------------------

model Accionista {
  id             Int              @id @default(autoincrement())
  nombre         String
  telefono       String?
  email          String           @unique
  codigo         String           @unique
  
  // üîê CAMPOS NUEVOS PARA LOGIN Y SEGURIDAD
  password       String           // Aqu√≠ guardaremos la contrase√±a hasheada
  rol            RolSistema       @default(USER) // Por defecto todos son usuarios normales
  
  fechaIngreso   DateTime         @default(now())
  direccion      String?
  tipoAccionista TipoAccionista
  estado         EstadoAccionista @default(Activo)
  notificacionesActivas Boolean   @default(true)
  
  ultimoAcceso   DateTime?
  
  multaBase      Decimal          @db.Decimal(10, 2) 

  pagos          Pago[]
  notificaciones Notificacion[]
  auditorias     Auditoria[]

  @@map("accionistas")
}

model Pago {
  id                Int      @id @default(autoincrement())
  referencia        String   @unique 
  
  accionistaId      Int
  accionista        Accionista @relation(fields: [accionistaId], references: [id])

  mes               String?
  dia               Int?
  monto             Decimal  @db.Decimal(10, 2)
  fechaIngresoMulta DateTime @default(now())
  fechaPago         DateTime?
  horaPago          String?
  
  estado            EstadoPago @default(Pendiente)
  metodo            String?
  descripcion       String?
  observacion       String?
  
  // üì∏ AQU√ç SE GUARDA LA URL DE LA FOTO (Ya lo ten√≠as bien)
  comprobante       String?     
  canal             String?
  
  email             String?
  telefono          String?
  
  fechaRegistro     DateTime @default(now())
  usuarioRegistro   String?

  abonos            Abono[]

  @@map("pagos")
}

model Abono {
  id         Int      @id @default(autoincrement())
  fecha      DateTime @default(now())
  monto      Decimal  @db.Decimal(10, 2)
  referencia String?
  
  pagoId     Int
  pago       Pago     @relation(fields: [pagoId], references: [id], onDelete: Cascade) 

  @@map("abonos")
}

model Notificacion {
  id           Int                   @id @default(autoincrement())
  
  accionistaId Int
  accionista   Accionista            @relation(fields: [accionistaId], references: [id])

  tipo         TipoNotificacion
  titulo       String
  mensaje      String                @db.Text 
  fecha        DateTime              @default(now())
  leida        Boolean               @default(false)
  accion       String?
  prioridad    PrioridadNotificacion @default(media)

  @@map("notificaciones")
}

model Auditoria {
  id           Int      @id @default(autoincrement())
  fecha        DateTime @default(now())
  accion       String   
  detalle      String?  
  usuario      String?  
  
  accionistaId Int?     
  accionista   Accionista? @relation(fields: [accionistaId], references: [id])

  @@map("auditorias")
}